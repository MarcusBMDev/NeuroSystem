<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NeuroChat</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div id="notification-area"></div>

    <div id="image-zoom-modal" class="modal-zoom" onclick="closeImageZoom()">
        <span class="close-zoom" onclick="closeImageZoom()">&times;</span>
        <img class="modal-zoom-img" id="img-zoom-target" onclick="event.stopPropagation()">
    </div>

    <div id="updates-modal" class="modal-overlay">
        <div class="modal" style="width: 650px; max-height: 85vh;">
            <div style="text-align: center; border-bottom: 1px solid #eee; padding-bottom: 15px;">
                <h2 style="color: #0d47a1; margin: 0;">ğŸ“š Manual & Novidades</h2>
                <p style="color: #666; margin-top: 5px;">Guia completo de uso do NeuroChat</p>
            </div>
            <div class="manual-content" style="overflow-y: auto; padding: 15px; margin-top: 5px; line-height: 1.6; text-align: left;">
                
                <h4 style="color: #1976d2; margin-bottom: 5px;">ğŸ“¸ Envio de Imagens RÃ¡pido</h4>
                <p style="font-size: 0.9rem; margin-bottom: 10px;">
                    VocÃª nÃ£o precisa clicar no botÃ£o de anexo (+) para enviar prints.<br>
                    <b>Computador:</b> Tire o print (PrtScn), clique na caixa de texto e aperte <b>Ctrl + V</b>.<br>
                    <b>Celular:</b> Copie a imagem da galeria e use "Colar" na caixa de texto.
                </p>

                <h4 style="color: #1976d2; margin-bottom: 5px;">âœï¸ FormataÃ§Ã£o de Texto</h4>
                <p style="font-size: 0.9rem; margin-bottom: 10px;">
                    <b>Negrito:</b> Coloque asteriscos em volta da palavra (Ex: *Importante* vira <b>Importante</b>).<br>
                    <b>Quebrar Linha:</b> Use <b>Shift + Enter</b> para pular linha sem enviar.
                </p>

                <h4 style="color: #1976d2; margin-bottom: 5px;">ğŸ”” NotificaÃ§Ãµes</h4>
                <p style="font-size: 0.9rem; margin-bottom: 10px;">
                    <b>Mensagens NÃ£o Lidas:</b> Um contador vermelho aparecerÃ¡ na lista de contatos/grupos quando houver novidades.<br>
                    <b>Aviso Sonoro:</b> O sistema emite um som discreto ao receber mensagens se vocÃª estiver em outra aba.
                </p>

                <h4 style="color: #1976d2; margin-bottom: 5px;">ğŸš€ Conversas e OrganizaÃ§Ã£o</h4>
                <p style="font-size: 0.9rem; margin-bottom: 10px;">
                    <b>Topo AutomÃ¡tico:</b> Quem manda mensagem sobe para o primeiro lugar da lista.<br>
                    <b>Destaque:</b> Conversas com mensagens nÃ£o lidas ficam em verde e no topo.<br>
                    <b>Marcar nÃ£o lida:</b> Clique no Ã­cone de carta (âœ‰ï¸) no topo do chat para lembrar de responder depois.
                </p>

                <hr style="border: 0; border-top: 1px solid #eee; margin: 15px 0;">

                <h3 style="color: #d32f2f; margin-bottom: 10px;">ğŸ†• Novas Funcionalidades</h3>

                <h4 style="color: #333; margin-bottom: 5px;">ğŸ˜€ ReaÃ§Ãµes e Menu de Mensagem</h4>
                <p style="font-size: 0.9rem; margin-bottom: 10px;">
                    Passe o mouse sobre qualquer mensagem (ou toque nela no celular) e clique na <b>setinha (âŒ„)</b> que aparece.<br>
                    Um menu se abrirÃ¡ com opÃ§Ãµes para:
                    <br>â€¢ <b>Reagir:</b> ğŸ‘ â¤ï¸ ğŸ˜‚ ğŸ˜® ğŸ˜¢ (As reaÃ§Ãµes se acumulam!)
                    <br>â€¢ <b>Responder:</b> Cita a mensagem especÃ­fica.
                    <br>â€¢ <b>Fixar:</b> Prende a mensagem no topo da conversa (Ãºtil para avisos).
                </p>

                <h4 style="color: #333; margin-bottom: 5px;">ğŸ›¡ï¸ SeguranÃ§a e Bloqueios (Admin)</h4>
                <p style="font-size: 0.9rem; margin-bottom: 10px;">
                    Administradores podem configurar <b>RestriÃ§Ãµes de Setor</b>. Se um usuÃ¡rio estiver bloqueado de falar com o "Financeiro", o sistema impedirÃ¡ o envio da mensagem e avisarÃ¡ o remetente na hora.
                </p>

                <h4 style="color: #333; margin-bottom: 5px;">ğŸ” Outros Recursos</h4>
                <p style="font-size: 0.9rem;">
                    <b>HistÃ³rico:</b> O chat carrega as Ãºltimas 30 mensagens. Role para cima para ver mais.<br>
                    <b>Busca:</b> Use a lupa no menu lateral para filtrar contatos ou a lupa no topo do chat para buscar mensagens.<br>
                    <b>Zoom:</b> Clique na foto de perfil ou em imagens enviadas para ampliar.
                </p>
            </div>
            <div class="modal-actions" style="justify-content: center; margin-top: 15px; border-top: 1px solid #eee; padding-top: 10px;">
                <button class="btn-create" onclick="document.getElementById('updates-modal').style.display='none'" style="width: 100%;">Entendi, vamos conversar!</button>
            </div>
        </div>
    </div>

    <div id="admin-control-modal" class="modal-overlay">
        <div class="modal" style="width: 500px;">
            <div style="text-align: center; border-bottom: 1px solid #eee; padding-bottom: 15px;">
                <h3 style="margin: 0; color: #666; font-size: 0.9rem;">âš™ï¸ Central de Controle</h3>
                <h2 id="admin-target-name" style="margin: 5px 0; color: #0d47a1;">UsuÃ¡rio</h2>
                <input type="hidden" id="admin-target-id">
            </div>
            
            <div style="margin-top: 15px;">
                <h4 style="margin-bottom: 10px; color: #d32f2f;">ğŸš« RestriÃ§Ãµes de Setor</h4>
                <p style="font-size: 0.85rem; color: #666;">Marque os setores que este usuÃ¡rio NÃƒO pode contatar:</p>
                <div id="admin-sector-list" style="max-height: 150px; overflow-y: auto; background: #fff3e0; padding: 10px; border: 1px solid #ffe0b2; border-radius: 5px; display: grid; grid-template-columns: 1fr 1fr; gap: 5px;"></div>
            </div>

            <div style="margin-top: 20px; display: flex; flex-direction: column; gap: 10px;">
                <button class="btn-create" style="background: #00796b;" onclick="openFullAudit()">ğŸ“„ Abrir HistÃ³rico Completo</button>
                <button id="btn-admin-promote" class="admin-action-btn" onclick="toggleAdminRole()" style="background: #1976d2;">ğŸ‘‘ Alternar Super Admin</button>
            </div>

            <div class="modal-actions" style="margin-top: 15px;">
                <button class="btn-cancel" onclick="document.getElementById('admin-control-modal').style.display='none'">Fechar</button>
            </div>
        </div>
    </div>

    <div id="profile-modal" class="modal-overlay">
        <div class="modal">
            <h3>Editar Meu Perfil</h3>
            <label>Nome:</label>
            <input type="text" id="profile-username" placeholder="Seu nome">
            
            <label>Departamento:</label>
            <select id="profile-department">
                <option value="" disabled selected>Selecione o Departamento</option>
                
                <optgroup label="Diretoria / EstratÃ©gico">
                    <option value="Diretoria Geral">Diretoria Geral</option>
                    <option value="Diretoria Financeira e Controle Interno">Diretoria Financeira e Controle Interno</option>
                    <option value="Diretoria PedagÃ³gica">Diretoria PedagÃ³gica</option>
                    <option value="Marketing">Marketing</option>
                </optgroup>

                <optgroup label="CoordenaÃ§Ãµes">
                    <option value="CoordenaÃ§Ã£o ABA">CoordenaÃ§Ã£o ABA</option>
                    <option value="CoordenaÃ§Ã£o Agendamento/RecepÃ§Ã£o">CoordenaÃ§Ã£o Agendamento/RecepÃ§Ã£o</option>
                    <option value="CoordenaÃ§Ã£o Faturamento">CoordenaÃ§Ã£o Faturamento</option>
                    <option value="CoordenaÃ§Ã£o Operacional">CoordenaÃ§Ã£o Operacional</option>
                    <option value="CoordenaÃ§Ã£o de RH">CoordenaÃ§Ã£o de RH</option>
                    <option value="CoordenaÃ§Ã£o TCC/AVN">CoordenaÃ§Ã£o TCC/AVN</option>
                </optgroup>

                <optgroup label="Administrativo & Financeiro">
                    <option value="Faturamento - Unidade 1">Faturamento - Unidade 1</option>
                    <option value="Faturamento - Unidade 3">Faturamento - Unidade 3</option>
                    <option value="Financeiro">Financeiro</option>
                    <option value="RH">RH</option>
                </optgroup>

                <optgroup label="Operacional / Atendimento">
                    <option value="Relacionamento e Comercial">Relacionamento e Comercial</option>
                    <option value="Assessoria">Assessoria</option>
                    <option value="RecepÃ§Ã£o 1">RecepÃ§Ã£o 1</option>
                    <option value="RecepÃ§Ã£o 2">RecepÃ§Ã£o 2</option>
                    <option value="RecepÃ§Ã£o 3">RecepÃ§Ã£o 3</option>
                </optgroup>

                <optgroup label="PedagÃ³gico / ClÃ­nico">
                    <option value="ABA">ABA</option>
                    <option value="Apoio AVN - Unidade 3">Apoio AVN - Unidade 3</option>
                    <option value="Apoio PedagÃ³gico">Apoio PedagÃ³gico</option>
                </optgroup>

                <optgroup label="Equipe TerapÃªutica">
                    <option value="Terapeutas - Unidade 1">Terapeutas - Unidade 1</option>
                    <option value="Terapeutas - Unidade 2">Terapeutas - Unidade 2</option>
                    <option value="Terapeutas - Unidade 3">Terapeutas - Unidade 3</option>
                </optgroup>
            </select>
            
            <label>Nova Foto:</label>
            <input type="file" id="profile-photo-input" accept="image/*">
            
            <label>Alterar Senha:</label>
            <input type="password" id="profile-password" placeholder="Nova senha">
            
            <div class="modal-actions">
                <button class="btn-cancel" onclick="document.getElementById('profile-modal').style.display='none'">Cancelar</button>
                <button class="btn-create" onclick="saveProfile()">Salvar</button>
            </div>
        </div>
    </div>

    <aside class="sidebar">
        <a href="http://192.168.10.133" class="btn-voltar-portal">â¬…ï¸ Voltar ao Portal</a>
        
        <div class="user-info">
            <img id="my-avatar-img" src="/avatar.png" class="my-avatar" onclick="window.openImageZoom(this.src)">
            <div class="user-details">
                <h3 id="user-name">...</h3>
                <span id="user-dept">...</span>
                <button class="edit-profile-btn" onclick="openProfileModal()">âœï¸ Editar Perfil</button>
            </div>
        </div>

        <div class="sidebar-tabs">
            <button id="tab-users" class="tab-btn active" onclick="switchTab('users')">
                UsuÃ¡rios <span id="badge-users" class="tab-badge" style="display:none">0</span>
            </button>
            <button id="tab-groups" class="tab-btn" onclick="switchTab('groups')">
                Grupos <span id="badge-groups" class="tab-badge" style="display:none">0</span>
            </button>
        </div>

        <div style="padding: 0 5px; margin-bottom: 10px;">
            <input type="text" id="contact-search" placeholder="ğŸ” Buscar..." onkeyup="filterContacts(this.value)" style="width: 100%; padding: 10px; border-radius: 20px; border: 1px solid #ccc;">
        </div>

        <div class="menu-section">
            <div id="groups-container" style="display: none;">
                <button class="new-group-btn" onclick="openModalCreate()">+ Criar Novo Grupo</button>
                <ul class="contact-list" id="groups-list"></ul>
            </div>
            <ul class="contact-list" id="users-list"></ul>
        </div>

        <button class="logout-btn" onclick="logout()">Sair</button>
    </aside>

    <main class="main-area">
        <div id="welcome-screen">
            <div class="welcome-box" style="background: white; padding: 40px; border-radius: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); text-align: center; max-width: 500px; width: 90%;">
                <h1 style="color: #0d47a1; margin: 0; font-size: 2.5rem;">NeuroChat</h1>
                <p style="color: #666; margin-top: 10px; margin-bottom: 30px;">Bem-vindo Ã  central de comunicaÃ§Ã£o interna.</p>

                <div style="background: #e8eaf6; border-left: 5px solid #1a237e; padding: 20px; text-align: left; border-radius: 8px; margin-bottom: 30px;">
                    <h4 style="color: #0d47a1; margin-top: 0; margin-bottom: 10px;">ğŸ“Œ Avisos Importantes</h4>
                    <p style="font-weight: bold; margin-bottom: 5px; color: #333;">OlÃ¡ pessoal!</p>
                    <p style="font-size: 0.9rem; color: #555; margin-bottom: 10px;">Seguem as instruÃ§Ãµes para o uso do Neurochat:</p>
                    <ul style="padding-left: 20px; color: #444; font-size: 0.9rem; line-height: 1.5;">
                        <li>1 - Insira seu nome e primeiro sobrenome.</li>
                        <li>2 - Solicite ao Marketing uma foto institucional para adicionar ao seu perfil.</li>
                        <li>3 - Foi criado o "MANUAL & NOVIDADES" que traz todas as melhorias do chat.</li>
                    </ul>
                </div>

                <button class="btn-news-center" onclick="openUpdatesModal()" style="background: #e3f2fd; color: #0d47a1; border: 1px solid #bbdefb; padding: 12px 30px; border-radius: 50px; font-weight: bold; cursor: pointer; transition: all 0.3s;">
                    ğŸ“š Manual & Novidades
                </button>
                
                <p style="margin-top: 30px; font-size: 0.85rem; color: #aaa;">
                    ğŸ‘ˆ Selecione um colega ou grupo no menu lateral para iniciar.
                </p>
            </div>
        </div>

        <div id="chat-interface">
            <div class="chat-header">
                <div class="header-left">
                    <img id="chat-header-img" src="/avatar.png" class="header-avatar">
                    <div class="header-info"><h2 id="chat-title">...</h2><span id="chat-dept" class="header-dept">...</span></div>
                </div>
                <div class="header-right">
                    <div class="search-box-chat" style="display:none" id="search-box-chat">
                        <input type="text" id="chat-search-input" placeholder="Buscar na conversa..." onkeyup="if(event.key==='Enter')window.nextSearch(); else window.searchInChat(this.value)">
                        <span id="search-count-display"></span>
                        <button onclick="window.prevSearch()">â–²</button>
                        <button onclick="window.nextSearch()">â–¼</button>
                    </div>
                    <button class="icon-btn" onclick="window.toggleChatSearch()" title="Buscar na conversa">ğŸ”</button>
                    
                    <button id="btn-mark-unread" class="icon-btn" onclick="markChatUnread()" title="Marcar como nÃ£o lida" style="display:none">âœ‰ï¸</button>
                    <button id="group-settings-btn" class="icon-btn settings-btn" onclick="openGroupSettings()" style="display:none">âš™ï¸</button>
                    <button class="icon-btn close-chat-btn" onclick="closeChat()">âœ•</button>
                </div>
            </div>
            
            <div id="pinned-bar" class="pinned-bar" style="display:none"></div>
            <ul id="messages"></ul>

            <div id="reply-area" class="reply-area" style="display:none">
                <div class="quoted-msg"><div class="quoted-user" id="reply-user"></div><div class="quoted-text" id="reply-text"></div></div>
                <button onclick="cancelReply()">âœ•</button>
            </div>

            <form id="form" action="">
                <input type="file" id="file-input" style="display:none" onchange="uploadFile()">
                <button type="button" class="upload-btn" onclick="document.getElementById('file-input').click()">+</button>
                <button type="button" id="emoji-btn" class="emoji-btn">ğŸ˜Š</button>
                <textarea id="input" rows="1" placeholder="Digite sua mensagem..." oninput="autoResize(this)" onkeydown="checkEnter(event)"></textarea>
                <button type="button" onclick="sendMessage()">Enviar</button>
            </form>
        </div>
    </main>

    <div id="group-modal" class="modal-overlay"><div class="modal"><h3>Novo Grupo</h3><input id="new-group-name" placeholder="Nome"><label><input type="checkbox" id="is-broadcast"> TransmissÃ£o</label><label><input type="checkbox" id="select-all-users" onchange="toggleAll(this)"> Todos</label><div id="modal-users-list" class="user-select-list"></div><div class="modal-actions"><button class="btn-create" onclick="createGroup()">Criar</button><button class="btn-cancel" onclick="document.getElementById('group-modal').style.display='none'">Cancelar</button></div></div></div>
    <div id="settings-modal" class="modal-overlay"><div class="modal"><h3>Grupo</h3><div id="settings-members-list" class="user-select-list"></div><div id="add-member-area" style="display:none; margin-top:10px;"><select id="add-member-select" style="width:100%; padding:8px;"></select><button class="btn-create" style="width:100%; margin-top:5px;" onclick="addNewMember()">Adicionar</button></div><div class="modal-actions" style="margin-top:10px;"><button id="btn-leave" class="btn-leave-group" onclick="leaveGroup()" style="display:none">Sair</button><button id="btn-delete" class="btn-delete-group" onclick="deleteGroup()" style="display:none">Excluir</button><button class="btn-cancel" onclick="document.getElementById('settings-modal').style.display='none'">Fechar</button></div></div></div>

    <script src="/socket.io/socket.io.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@joeattardi/emoji-button@3.0.3/dist/index.min.js"></script>
    <script src="js/chat.js"></script>
    <script src="js/marketing.js"></script>
</body>
</body>
</html>