<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NeuroChat</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div id="notification-area"></div>

    <div id="image-zoom-modal" class="modal-zoom" onclick="closeImageZoom()">
        <span class="close-zoom" onclick="closeImageZoom()">&times;</span>
        <img class="modal-zoom-img" id="img-zoom-target" onclick="event.stopPropagation()">
    </div>

   <div id="updates-modal" class="modal-overlay">
        <div class="modal" style="width: 600px; max-height: 85vh;">
            <div style="text-align: center; border-bottom: 1px solid #eee; padding-bottom: 15px;">
                <h2 style="color: #0d47a1; margin: 0;">üìö Manual & Funcionalidades</h2>
                <p style="color: #666; margin-top: 5px;">Aprenda a usar todo o potencial do NeuroChat</p>
            </div>
            
            <div class="manual-content" style="overflow-y: auto; padding: 10px; margin-top: 10px;">
                
                <div class="manual-section">
                    <h3 style="background: #e3f2fd; color: #0d47a1; padding: 8px; border-radius: 5px;">üì∏ Envio de Imagens R√°pido</h3>
                    <p>Voc√™ n√£o precisa clicar no bot√£o de anexo (+) para enviar prints.</p>
                    <ul>
                        <li><strong>Computador:</strong> Tire o print (PrtScn), clique na caixa de texto ("Digite sua mensagem...") e aperte <code>Ctrl + V</code>. A imagem ser√° enviada automaticamente!</li>
                        <li><strong>Celular:</strong> Se copiar uma imagem da galeria, basta "Colar" na caixa de texto.</li>
                    </ul>
                </div>

                <div class="manual-section" style="margin-top: 15px;">
                    <h3 style="background: #fff3e0; color: #e65100; padding: 8px; border-radius: 5px;">‚úçÔ∏è Formata√ß√£o de Texto</h3>
                    <p>Deixe suas mensagens mais organizadas:</p>
                    <ul>
                        <li><strong>Negrito:</strong> Coloque asteriscos em volta da palavra. <br>Ex: Digite <code>*Importante*</code> para aparecer <strong>Importante</strong>.</li>
                        <li><strong>Quebrar Linha:</strong> No computador, use <code>Shift + Enter</code> para pular para a linha de baixo sem enviar a mensagem.</li>
                    </ul>
                </div>

                <div class="manual-section" style="margin-top: 15px;">
                    <h3 style="background: #e8f5e9; color: #2e7d32; padding: 8px; border-radius: 5px;">‚úÖ Confirma√ß√£o de Leitura</h3>
                    <ul>
                        <li><span style="color:#aaa">‚úî‚úî</span> (Cinza): Mensagem entregue.</li>
                        <li><span style="color:#29b6f6">‚úî‚úî</span> (Azul): O colega j√° <strong>leu</strong> sua mensagem (funciona em tempo real!).</li>
                    </ul>
                </div>

                <div class="manual-section" style="margin-top: 15px;">
                    <h3 style="background: #f3e5f5; color: #7b1fa2; padding: 8px; border-radius: 5px;">üîç Outros Recursos</h3>
                    <ul>
                        <li><strong>Hist√≥rico:</strong> O chat carrega as √∫ltimas 30 mensagens. Role para cima e clique no bot√£o de recarregar para ver as antigas.</li>
                        <li><strong>Busca:</strong> Use a lupa no topo para procurar palavras em conversas antigas.</li>
                        <li><strong>Zoom:</strong> Clique na foto do perfil de algu√©m ou numa imagem enviada para ver em tela cheia.</li>
                    </ul>
                </div>
                <div class="manual-section" style="margin-bottom: 20px;">
                    <h3 style="background: #e0f2f1; color: #00695c; padding: 10px; border-radius: 8px; font-size: 1rem; margin-bottom: 10px;">
                    üöÄ Conversas Recentes no Topo
                    </h3>
                        <p style="font-size: 0.95rem; color: #030303; margin-bottom: 5px;">Chega de rolar a lista procurando quem chamou!</p>
                        <ul style="color: #050505; font-size: 0.9rem;">
                        <li><strong>Autom√°tico:</strong> Assim que algu√©m manda mensagem (ou voc√™ responde), o contato sobe para o <strong>primeiro lugar</strong> da lista.</li>
                        <li><strong>Destaque:</strong> Quem tem mensagens n√£o lidas fica sempre em cima para voc√™ n√£o perder nada.</li>
                    </ul>
                </div>

            </div>
            <div class="modal-actions" style="justify-content: center; margin-top: 20px; border-top: 1px solid #eee; padding-top: 15px;">
                <button class="btn-create" onclick="document.getElementById('updates-modal').style.display='none'" style="width: 100%;">Entendi, vamos l√°!</button>
            </div>
        </div>
    </div>

    <div id="profile-modal" class="modal-overlay">
        <div class="modal">
            <h3>Editar Meu Perfil</h3>
            <label>Nome:</label>
            <input type="text" id="profile-username" placeholder="Seu nome">
            <label>Departamento:</label>
            <select id="profile-department">
                <option value="" disabled selected>Selecione...</option>
                <optgroup label="Diretoria / Estrat√©gico">
                    <option value="Diretoria Geral">Diretoria Geral</option>
                    <option value="Diretoria Financeira e Controle Interno">Diretoria Financeira e Controle Interno</option>
                    <option value="Diretoria Pedag√≥gica">Diretoria Pedag√≥gica</option>
                    <option value="Marketing">Marketing</option>
                </optgroup>
                <optgroup label="Coordena√ß√µes">
                    <option value="Coordena√ß√£o ABA">Coordena√ß√£o ABA</option>
                    <option value="Coordena√ß√£o Agendamento/Recep√ß√£o">Coordena√ß√£o Agendamento/Recep√ß√£o</option>
                    <option value="Coordena√ß√£o Faturamento">Coordena√ß√£o Faturamento</option>
                    <option value="Coordena√ß√£o Operacional">Coordena√ß√£o Operacional</option>
                    <option value="Coordena√ß√£o de RH">Coordena√ß√£o de RH</option>
                    <option value="Coordena√ß√£o TCC/AVN">Coordena√ß√£o TCC/AVN</option>
                </optgroup>
                <optgroup label="Administrativo & Financeiro">
                    <option value="Faturamento - Unidade 1">Faturamento - Unidade 1</option>
                    <option value="Faturamento - Unidade 3">Faturamento - Unidade 3</option>
                    <option value="Financeiro">Financeiro</option>
                    <option value="RH">RH</option>
                </optgroup>
                <optgroup label="Operacional / Atendimento">
                    <option value="Relacionamento e Comercial">Relacionamento e Comercial</option>
                    <option value="Assessoria">Assessoria</option>
                    <option value="Recep√ß√£o 1">Recep√ß√£o 1</option>
                    <option value="Recep√ß√£o 2">Recep√ß√£o 2</option>
                    <option value="Recep√ß√£o 3">Recep√ß√£o 3</option>
                    <option value="ASG - UNIDADE 1">ASG - UNIDADE 1</option>
                    <option value="ASG - UNIDADE 3">ASG - UNIDADE 3</option>
                    
                </optgroup>
                <optgroup label="Pedag√≥gico / Cl√≠nico">
                    <option value="ABA">ABA</option>
                    <option value="Apoio AVN - Unidade 3">Apoio AVN - Unidade 3</option>
                    <option value="Apoio Pedag√≥gico">Apoio Pedag√≥gico</option>
                </optgroup>
                <optgroup label="Equipe Terap√™utica">
                    <option value="Terapeutas - Unidade 1">Terapeutas - Unidade 1</option>
                    <option value="Terapeutas - Unidade 2">Terapeutas - Unidade 2</option>
                    <option value="Terapeutas - Unidade 3">Terapeutas - Unidade 3</option>
                </optgroup>
            </select>
            <label>Nova Foto:</label><input type="file" id="profile-photo-input" accept="image/*">
            <label>Alterar Senha:</label><input type="password" id="profile-password" placeholder="Nova senha">
            <div class="modal-actions">
                <button class="btn-cancel" onclick="document.getElementById('profile-modal').style.display='none'">Cancelar</button>
                <button class="btn-create" onclick="saveProfile()">Salvar</button>
            </div>
        </div>
    </div>

    <div id="audit-modal" class="modal-overlay">
        <div class="modal" style="width: 500px; max-height: 90vh;">
            <h3>üïµÔ∏è Auditoria de Conversas</h3>
            <div style="display:flex; gap:10px; margin-bottom:15px;">
                <div style="flex:1"><label>Funcion√°rio A:</label><select id="audit-user-a"></select></div>
                <div style="flex:1"><label>Funcion√°rio B:</label><select id="audit-user-b"></select></div>
            </div>
            <button class="btn-create" onclick="loadAuditHistory()" style="width:100%">Pesquisar Conversa</button>
            <div id="audit-results" style="flex-grow:1; overflow-y:auto; background:#f5f5f5; padding:10px; border-radius:5px; border:1px solid #ddd; min-height:200px; margin-top:15px;"></div>
            <div class="modal-actions"><button class="btn-cancel" onclick="document.getElementById('audit-modal').style.display='none'">Fechar</button></div>
        </div>
    </div>

    <div id="group-modal" class="modal-overlay">
        <div class="modal">
            <h3>Novo Grupo</h3>
            <input type="text" id="new-group-name" placeholder="Nome do Grupo">
            <label style="display:flex; align-items:center; cursor:pointer; background:#f9f9f9; padding:10px; border-radius:5px; margin-bottom: 10px;">
                <input type="checkbox" id="is-broadcast" style="width:auto; margin-right:10px;"> Grupo de Transmiss√£o
            </label>
            <label>Selecionar Membros:</label>
            <label style="font-weight: bold; margin-bottom: 5px; display: block; font-size: 0.9rem;">
                <input type="checkbox" id="select-all-users" style="width:auto; margin-right: 5px;" onchange="toggleAll(this)"> Selecionar Todos
            </label>
            <div class="user-select-list" id="modal-users-list"></div>
            <div class="modal-actions"><button class="btn-cancel" onclick="document.getElementById('group-modal').style.display='none'">Cancelar</button><button class="btn-create" onclick="createGroup()">Criar</button></div>
        </div>
    </div>

    <div id="settings-modal" class="modal-overlay">
        <div class="modal">
            <h3 id="settings-title">Membros do Grupo</h3>
            <div class="user-select-list" id="settings-members-list"></div>
            <div id="add-member-area" style="display:none; border-top:1px solid #ccc; padding-top:10px;"><label>Adicionar Membro:</label><select id="add-member-select" style="width:100%; padding:8px; margin-bottom:5px;"></select><button class="btn-create" style="width:100%" onclick="addNewMember()">Adicionar</button></div>
            <div class="modal-actions" style="margin-top: 20px; border-top: 1px solid #eee; padding-top: 10px;">
                <button id="btn-leave" class="btn-leave-group" onclick="leaveGroup()" style="display:none">Sair do Grupo</button>
                <button id="btn-delete" class="btn-delete-group" onclick="deleteGroup()" style="display:none">EXCLUIR GRUPO</button>
                <button class="btn-cancel" onclick="document.getElementById('settings-modal').style.display='none'">Fechar</button>
            </div>
        </div>
    </div>

    <aside class="sidebar">
        <div class="user-info">
            <img id="my-avatar-img" src="/avatar.png" class="my-avatar" onerror="this.src='/avatar.png'" onclick="window.openImageZoom(this.src)">
            <div class="user-details"><h3 id="user-name">...</h3><span id="user-dept">...</span><br><button class="edit-profile-btn" onclick="openProfileModal()">Editar Perfil</button></div>
        </div>

        <div style="margin-bottom: 15px; padding: 0 5px;">
            <input type="text" placeholder="üîç Buscar funcion√°rio..." onkeyup="filterContacts(this.value)" style="width: 100%; padding: 10px; border-radius: 20px; border: 1px solid #ccc; font-size: 0.9rem;">
        </div>

        <div class="menu-section">
            <h4>GRUPOS <button id="btn-new-group" class="new-group-btn" onclick="openModalCreate()">+</button></h4><ul class="contact-list" id="groups-list"></ul><br>
            <h4>FUNCION√ÅRIOS</h4><ul class="contact-list" id="users-list"></ul>
        </div>
        
        <button id="btn-audit" class="audit-btn" style="display:none; margin-bottom: 10px;" onclick="openAuditModal()">üïµÔ∏è Auditoria</button>
        <button class="logout-btn" onclick="logout()">Sair</button>
    </aside>

    <main class="main-area">
        <div id="welcome-screen">
            <div class="welcome-box">
                <h2 style="color: #0d47a1; font-size: 2rem; margin-bottom: 10px;">NeuroChat</h2>
                <p style="color: #555; margin-bottom: 20px;">Bem-vindo √† central de comunica√ß√£o interna.</p>
                <div style="background: #e8eaf6; padding: 20px; border-radius: 10px; text-align: left; border-left: 5px solid #1a237e;">
                    <h4 style="color: #0d47a1; margin: 0 0 10px 0;">üìå Avisos Importantes</h4>
                    <p style="margin: 0; font-weight: bold; color: #333;">Ol√° pessoal!</p>
                    <p style="margin: 10px 0; font-size: 0.9rem; color: #555;">Seguem as instru√ß√µes para o uso do Neurochat:</p>
                    <ul style="margin: 0; padding-left: 20px; color: #555; font-size: 0.9rem;">
                        <li>1 - Insira seu nome e primeiro sobrenome.</li>
                        <li>2 - Solicite ao Marketing uma foto institucional para adicionar ao seu perfil.</li>
                        <li>3 - Foi criado o "MANUAL & NOVIDADES" que tr√°s todas a melhorias do chat.</li>
                    </ul>
                </div>
                
                <button class="btn-news-center" onclick="openUpdatesModal()">üìö Ler Manual & Novidades</button>

                <div style="margin-top: 30px; color: #888; font-size: 0.9rem;">
                    üëà Selecione um colega ou grupo no menu lateral para iniciar.
                </div>
            </div>
        </div>

        <div id="chat-interface">
            <div class="chat-header">
                <div class="header-left"><img id="chat-header-img" src="/avatar.png" class="header-avatar" style="display:none" onerror="this.src='/avatar.png'"><div class="header-info"><h2 id="chat-title">...</h2><span id="chat-dept" class="header-dept">...</span></div></div>
                <div class="header-right">
                    <button id="group-settings-btn" class="icon-btn settings-btn" style="display:none" onclick="openGroupSettings()" title="Gerenciar Grupo">‚öôÔ∏è</button>
                    
                    <div class="search-container">
                        <input type="text" id="chat-search-input" class="search-input-nav" placeholder="Buscar..." onkeyup="searchInChat(this.value)">
                        <div class="search-actions">
                            <span id="search-count-display" class="search-count"></span>
                            <button class="search-btn-nav" onclick="prevSearch()" title="Anterior">‚ñ≤</button>
                            <button class="search-btn-nav" onclick="nextSearch()" title="Pr√≥ximo">‚ñº</button>
                        </div>
                    </div>

                    <button class="icon-btn close-chat-btn" onclick="closeChat()" title="Fechar">‚úï</button>
                </div>
            </div>
            
            <div id="pinned-bar" class="pinned-bar" style="display:none"></div>

            <ul id="messages"></ul>

            <div id="reply-area" class="reply-area" style="display:none">
                <div class="quoted-msg">
                    <div class="quoted-user" id="reply-user"></div>
                    <div class="quoted-text" id="reply-text"></div>
                </div>
                <button onclick="cancelReply()" style="background:none;border:none;font-size:1.2rem;cursor:pointer;">‚úï</button>
            </div>
            
            <form id="form" action="">
                <input type="file" id="file-input" style="display: none;" onchange="uploadFile()">
                <button type="button" class="upload-btn" onclick="document.getElementById('file-input').click()">+</button>
                <button type="button" id="emoji-btn" class="emoji-btn">üòä</button>
                <textarea id="input" autocomplete="off" placeholder="Digite sua mensagem..." rows="1" oninput="autoResize(this)" onkeydown="checkEnter(event)"></textarea>
                <button type="button" onclick="sendMessage()">Enviar</button>
            </form>
            
            <div id="broadcast-notice" class="broadcast-notice" style="display:none">üì¢ Grupo de Transmiss√£o: Apenas administradores podem enviar mensagens.</div>
        </div>
    </main>

    <script src="/socket.io/socket.io.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@joeattardi/emoji-button@3.0.3/dist/index.min.js"></script>
    <script src="js/chat.js"></script>
</body>
</html>